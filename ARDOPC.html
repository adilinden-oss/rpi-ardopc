<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
    
<style type="text/css">
body {background: white;color: black}
h1 {color: #c33;background: none;font-weight: bold;text-align: center}
h2 {color: #00008b;background: none;font-weight: bold}
h3 {color: #006400;background: none;margin-left: 4%;margin-right: 4%;font-weight: bold}
h4 {margin-left: 8%;margin-right: 8%;font-weight: bold}
h5 {margin-left: 6%;margin-right: 6%;font-weight: bold}
div {margin-left: 9%;margin-right: 10%;}
ul, ol, dl, p {margin-left: 6%;margin-right: 6%}
pre {margin-left: 10%;white-space: pre}

</style> 
<title>Running ARDOPC</title>
</head>
<h1>Running ARDOPC</h1>
  
 <body>
 
 <h2>Some notes on ardopc (my C version of ARDOP_WIN)</h2>
<p>
ardopc is a command line program. It supports two host interfaces, TCP (using two TCP ports) or Serial using a Virtual COM 
port to link to the host.
 The serial interface can emulate an SCS Dragon controller, allowing programs that don't 
  support ardop but support the Dragon (such as Winlink Express or Airmail) to use ardop. 
<br><br>
If run without any parameters it listens on TCP port 8515,
 on Linux it uses the virtual sound device ARDOP, and on Windows the first
  available capture and playback device. 

You can specify command line parameters port capture device playback device.
<br><br>
For TCP Host connection, port is TCP Port Number.<br>
For Serial Host connection port must start with "COM" or "com"<br>
 On Windows use the name of the BPQ Virtual COM Port, eg COM4. See below for info on installing the BPQ Virtual COM port driver<br>
 On Linux the program will create a pty and symlink it to the specified name.<br>
<br>
 On Linux the capture and playback devices are in hw:1,0 format. In Windows it is a number starting
  from zero or a string that matches part of the device name. When you start the program
   it will list all the sound devices so you can select the right one.
    If you are specifying sound devices you must also include the port, eg
<pre>
./ardopc 8515 hw:1,0 hw:1,0  (Linux TCP)
ardopc 8515 1 1              (Windows TCP using second device in list)
./ardopc com10 hw:1,0 hw:1,0 (Linux Serial)
ardopc COM10 USB USB         (Windows Serial using device USB Audio CODEC)
</pre><p>
On Linux not many soundcards support the required sampling rate of 12000 samples/sec. See paragraph 
below on rate conversion if your card doesn't.<br>
<br>
The TNC supports a number of options for PTT. When using the TCP interface it will send commands to the host
to allow it to contol PTT. This is most useful when the host program is running 
more than one sound card mode (eg ARDOP and WINMOR). The TNC can also key the radio via a hardware or
 software (CAT) interface. There are a number of optional command line parameters to control this
<br><pre>
-p device or --ptt device         Device to use for PTT control using RTS or GPIO Pin (Raspbery Pi only)
-c device or --cat device         Device to use for CAT Control
-k string or --keystring string   String (In HEX) to send to the radio to key PTT
-u string or --unkeystring string String (In HEX) to send to the radio to unkeykey PTT
 </pre><p>
 Hardware control is normally via the RTS line on a COM port (possibly a Virtual COM Port, eg with the IC7300).
  On a Raspberry PI a GPIO pin can also be used. For example<br>
  -c COM10<br>
  -c /dev/ttyUSB0<br>
  -c GPIO (Using default pin 17) or -c GPIO=n (Using a different pin).<br>
<br>
The -c or --cat paramter is specified in the form port:speed, eg com1:19200 or /dev/tty0:19200. Some host 
programs (such as BPQ32/LinBPQ and Winlink Express) can send radio control commands for frequency and mode setting 
over this port, but for reasons of latency the PTT commands have to be generated by the TNC. Some host programs (such as BPQ32/LinBPQ)
can set these commands over the ardop control interface, but for others the -k and -u commands are used. The value 
is the string (specified in hex) to be sent to key or unkey the radio. For example for most ICOM radios you 
could use<br>
<br>
-k FEFE88E01C0001FD -u FEFE88E01C0000FD<br>
<br><br>
CAT and RTS PTT can share the same com port, so for radios like the IC7300 which support keying via RTS
on the virtual com port you could have the application controlling frequency and the TNC controlling PTT.


Apart from the command line params above there is no configuration. All parameters are set by the application, though there are reasonable defaults for most of them.
<br><br>
The program writes a debug log as well as debugging information to the program console.
<br><br>
To simplify setting the audio input the program displays the peak input level every 10 seconds.
 The program works with signed 16 bit samples, so the values will be in the range -32768 to 32767.
  Clipping will cause distortion, so it is import to keep away from the limits.
   I've found in practice that it will work down to quite low levels, but try to keep in the range +-20000.
 <br><br>

The software can be downloaded from 
<br><br>

<a href="http://www.cantab.net/users/john.wiseman/Downloads/Beta/ardopc">http://www.cantab.net/users/john.wiseman/Downloads/Beta/ardopc</a><br>
<a href="http://www.cantab.net/users/john.wiseman/Downloads/Beta/piardopc">http://www.cantab.net/users/john.wiseman/Downloads/Beta/piardopc</a><br>
<a href="http://www.cantab.net/users/john.wiseman/Downloads/Beta/ARDOPC.exe">http://www.cantab.net/users/john.wiseman/Downloads/Beta/ARDOPC.exe</a><br>
<br>

<h3>Sampling Rate Conversion</h3>
<p>
ARDOP uses a sampling rate of 12000 samples/second, and not all that many Linux sound cards support 
this directly. So if you are using Linux you will probably 
have to enable sample rate conversion. This is achieved by adding the following to the alsa configuration. 
I suggest you add it to the user configuration file .asoundrc, creating the file if it doesn't already exist.
 The file should be in the user's home directory.
Note there is a dot on the front of the name, which isn't obvious with some fonts.

<pre>
pcm.ARDOP {type rate slave {pcm "hw:1,0" rate 48000}}

</pre>
<p>This creates a virtual rate conversion device called ARDOP, using the real device hw:1,0,
 and running the real device at 48000. If the sound card you are using isn't hw:1,0, 
 then change the line to match your device.<br>
 <br>
 You can also enable sample rate converison using the ALSA "plug" device, eg plughw:1,0, but as this 
 doesn't allow you to specify the real sampling rate I prefer using the virtual device.
 
<h3>Virtual COM Port Installation</h3>
<p>If you have installed BPQ32 the needed files are in folders VCOM32 or VCOM64 under your 
BPQ32 Programs folder. If you don't use BPQ32 you can download the files as part of the CAT7200
 installation. Download <a href="http://www.cantab.net/users/john.wiseman/Downloads/CAT7200.zip">http://www.cantab.net/users/john.wiseman/Downloads/CAT7200.zip</a>
and unzip to a convenient folder.<br>
<br>
Note that there are separate versions for 32bit and 64bit Windows, in
the VCOM32 and VCOM64 subdirectories - make sure you install the right
one. <br>
<br>
For Installation on Windows XP, see intructions <a href="VCUSMInstallXP.htm">here</a>.<br>
<br>
To Install on a Windows 8 or Windows 10 64 bit system you must <a href="http://www.makeuseof.com/tag/how-can-i-install-hardware-with-unsigned-drivers-in-windows-8/">reboot
with advanced options</a> to disable driver signature
enforcement.
<br><br>
With Windows 7 and above, you should be able to install the driver by
right clicking on InstallBPQVCOM.exe (or InstallBPQVCOM32.exe if 32
bit) and selecting "Run as Administrator". If that fails, <a href="VCUSMInstallW7.htm">follow these intructions</a>.<br>
<br>
Use Device manager to identify the COM port number allocated to your
Virtual COM Port.
</p>
<h3>ARDOP_GUI</h3>
<p>
I've written an experimental graphical front end for ardopc. It runs on Windows or Linux and can connect to ardopc running on either the same or another machine. It looks similar to the ARDOP_Win.exe window, with constellation and waterfall or spectrum displays and various status indicators. The configuration parameters are the IP Address and Port of the ardop instance it is to connect to. These can be entered in the config dialog or on the command line. (which is needed if you want to run more than one copy). It can be downloaded from<br>
<br>
 <a href="http://www.cantab.net/users/john.wiseman/Downloads/Beta/ARDOP_GUIWin32.zip">http://www.cantab.net/users/john.wiseman/Downloads/Beta/ARDOP_GUIWin32.zip</a><br>
 <a href="http://www.cantab.net/users/john.wiseman/Downloads/Beta/ARDOP_GUI">http://www.cantab.net/users/john.wiseman/Downloads/Beta/ARDOP_GUI</a><br>
 <a href="http://www.cantab.net/users/john.wiseman/Downloads/Beta/piARDOP_GUI">http://www.cantab.net/users/john.wiseman/Downloads/Beta/piARDOP_GUI</a><br>
 <br>
 The source can be found at <a href="http://www.cantab.net/users/john.wiseman/Downloads/Beta/ARDOP_GUI.zip">http://www.cantab.net/users/john.wiseman/Downloads/Beta/ARDOP_GUI.zip</a>

<br><br>
The software uses the QT5 graphics toolkit. The Windows download includes all needed libraries. On Linux, unless you already have QT5 applications installed you will probably have to install the QT runtime - sudo apt-get install qt5-default
<br><br>
The Windows version runs on 32 or 64 bit windows systems.

<br><br>
John Wiseman G8BPQ<br>
January 2018

</body>
</html>